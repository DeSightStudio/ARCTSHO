(()=>{let u={cookieName:"auto_language_detected",geoServices:["https://ipapi.co/json/","https://ip-api.com/json/?fields=countryCode"],countryLanguageMap:{DE:"de",AT:"de",CH:"de",ES:"es",FR:"fr",AR:"es",CL:"es",MX:"es",IT:"it"},defaultLanguage:"en",requestTimeout:3e3,debug:!1};function l(){var e=new Date;e.setTime(e.getTime()+2592e6),document.cookie=u.cookieName+"=true; expires="+e.toUTCString()+"; path=/; SameSite=Lax"}function g(){u.debug}async function d(){n=new URLSearchParams(window.location.search),e=n.get("test_country"),"true"===n.get("debug_lang")&&(u.debug=!0,g("Debug-Modus aktiviert"));var e,t,n=e?(g("Test-Modus erkannt für Land:",e),e.toUpperCase()):null;if(n)return n;for(t of u.geoServices)try{g("Versuche Geolocation Service:",t);let e=new AbortController;var o=setTimeout(()=>e.abort(),u.requestTimeout),a=await fetch(t,{signal:e.signal,headers:{Accept:"application/json"}});if(clearTimeout(o),!a.ok)throw new Error("HTTP "+a.status);var r=await a.json(),c=(g("Geolocation Response:",r),r.country_code||r.countryCode||r.country);if(c&&"string"==typeof c)return g("Land erkannt:",c),c.toUpperCase()}catch(e){g("Geolocation Service Fehler:",e.message);continue}return g("Alle Geolocation Services fehlgeschlagen"),null}async function e(){try{var e,t;g("Starte automatische Spracherkennung"),-1!==document.cookie.indexOf(u.cookieName+"=")?g("Automatische Spracherkennung bereits durchgeführt"):(e=await d())?(t=(i=e)?(g("Sprache für Land",i+":",i=u.countryLanguageMap[i]||u.defaultLanguage),i):u.defaultLanguage,r=t,g("Aktuelle Sprache:",c=document.documentElement.lang||window.location.pathname.split("/")[1]||"de"),g("Ziel-Sprache:",r),c===r?(g("Sprache bereits korrekt, keine Änderung nötig"),l()):(g("Führe Sprachänderung durch zu:",n=t),((a=document.querySelector("localization-form form")||document.querySelector('form[action*="/localization"]')||document.querySelector(".localization-form form"))?(o=a.querySelector('input[name="language_code"]')||a.querySelector('select[name="language_code"]'))?(o.value=n,l(),g("Sende Localization Form ab"),a.submit(),0):(g("Kein Language Input gefunden"),1):(g("Kein Localization Form gefunden"),1))&&(g("Sprachänderung fehlgeschlagen"),l()))):(g("Land konnte nicht ermittelt werden"),l())}catch(e){g("Fehler bei automatischer Spracherkennung:",e),l()}var n,o,a,r,c,i}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):setTimeout(e,100),u.debug&&(window.autoLanguageDetection={performDetection:e,getCountry:d,config:u})})(),console.log("Auto-Language-Detection geladen");