class NewProductBadge{constructor(){this.init()}init(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.processAllProducts()):this.processAllProducts(),document.addEventListener("facets:updated",()=>{setTimeout(()=>this.processAllProducts(),100)}),document.addEventListener("collection:updated",()=>{setTimeout(()=>this.processAllProducts(),100)})}processAllProducts(){console.log("NewProductBadge: Verarbeite alle Produkte..."),document.querySelectorAll(".card-wrapper, .product-card-wrapper").forEach(e=>{this.processProductCard(e)})}processProductCard(e){try{var t=this.getProductCreatedAt(e);t?this.isProductNew(t)?this.addNewBadge(e):this.removeNewBadge(e):console.log("NewProductBadge: Kein created_at Datum gefunden für Produktkarte")}catch(e){console.error("NewProductBadge: Fehler beim Verarbeiten der Produktkarte:",e)}}getProductCreatedAt(e){var t=e.dataset.createdAt||e.querySelector("[data-created-at]")?.dataset.createdAt;if(t)return new Date(t);t=e.querySelector('script[type="application/json"]');if(t)try{var r=JSON.parse(t.textContent);if(r.created_at)return new Date(r.created_at)}catch(e){console.log("NewProductBadge: Fehler beim Parsen der Produktdaten:",e)}t=this.getProductId(e);return t&&window.productData&&window.productData[t]?new Date(window.productData[t].created_at):null}getProductId(e){var t=e.querySelector('a[href*="/products/"]');if(t){t=t.href.match(/\/products\/([^/?]+)/);if(t)return t[1]}t=e.dataset.productId||e.querySelector("[data-product-id]")?.dataset.productId;return t||null}isProductNew(e){var t=(new Date-e)/36e5,e=(console.log(`NewProductBadge: Produkt erstellt vor ${t.toFixed(1)} Stunden`),this.getProductIdFromCard(e));return"10875"===e||10875===e?(console.log("NewProductBadge: TEST-MODUS - Produkt 10875 wird als NEU angezeigt"),!0):t<=48}getProductIdFromCard(e){var t;for(t of document.querySelectorAll(".card-wrapper[data-created-at]")){var r=new Date(t.dataset.createdAt);if(Math.abs(r-e)<1e3)return t.dataset.productId}return null}addNewBadge(t){if(!t.querySelector(".badge--new")){let e=t.querySelector(".card__badge");if(!e){t=t.querySelector(".card__media");if(!t)return void console.log("NewProductBadge: Kein .card__media gefunden für Badge-Container");(e=document.createElement("div")).className="card__badge top-right",t.appendChild(e)}t=document.createElement("span");t.className="badge badge--top-right badge--new",t.textContent=this.getNewText(),e.appendChild(t),console.log('NewProductBadge: "Neu"-Badge hinzugefügt')}}removeNewBadge(e){e=e.querySelector(".badge--new");e&&(e.remove(),console.log('NewProductBadge: "Neu"-Badge entfernt'))}getNewText(){var e;return window.variantStrings&&window.variantStrings.newProduct?window.variantStrings.newProduct:(e={de:"Neu",en:"New",it:"Nuovo",es:"Nuevo",fr:"Nouveau"})[document.documentElement.lang||"en"]||e.en}}document.addEventListener("DOMContentLoaded",()=>{new NewProductBadge}),window.NewProductBadge=NewProductBadge;