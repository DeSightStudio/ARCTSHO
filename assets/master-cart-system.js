console.log("ðŸš€ Master Cart System wird geladen..."),window.MasterCartSystem&&(console.log("MasterCartSystem: Vorherige Instanz gefunden - entferne sie"),window.MasterCartSystem.destroy());class MasterCartSystem{constructor(){this.isActive=!0,this.cartData=null,this.lastSyncTime=0,this.syncInProgress=!1,this.eventHandlers=new Map,this.debounceTimer=null,this.debounceDelay=100,this.init()}async init(){console.log("ðŸš€ MasterCartSystem: Initialisierung gestartet"),this.disableOtherCartSystems(),await this.loadInitialCartData(),this.setupEventListeners(),this.initializeUIComponents(),this.setupCartDrawer(),this.setupCartIconUpdater(),this.setupCartRedirect(),this.setupInfiniteScroll(),this.setupUnitConverter(),this.setupExternalLinks(),this.setupBrowserNavigationFix(),console.log("ðŸš€ MasterCartSystem: Initialisierung abgeschlossen")}disableOtherCartSystems(){console.log("ðŸš€ Deaktiviere andere Cart-Systeme..."),window.cartStateManager&&(window.cartStateManager.isActive=!1);["cart:updated","cart:item:added","cart:item:removed","cart:state:updated","cart:buttons:update","drawer:opened","drawer:closed"].forEach(e=>{document.addEventListener(e,t=>{t.detail?.masterCartSystem||(t.stopImmediatePropagation(),console.log("ðŸš€ Event gestoppt:",e))},{capture:!0})}),document.addEventListener("submit",t=>{var e=t.target.closest('form[action*="/cart/add"]');e&&!t.detail?.masterCartSystem&&(console.log("ðŸš€ Fremder Form Submit gestoppt, Ã¼bernehme Master Cart System"),t.preventDefault(),t.stopImmediatePropagation(),this.handleAddToCart(e))},{capture:!0})}async loadInitialCartData(){try{console.log("ðŸš€ Lade initiale Cart-Daten...");var t=this.loadFromCache();t&&(this.cartData=t,console.log("ðŸš€ Cache-Daten geladen:",this.cartData.item_count,"Artikel"));var e=await(await fetch("/cart.js")).json();this.cartData&&this.cartData.item_count===e.item_count||(this.cartData=e,this.saveToCache(e),console.log("ðŸš€ Server-Daten geladen:",this.cartData.item_count,"Artikel"))}catch(t){console.error("ðŸš€ Fehler beim Laden der Cart-Daten:",t)}}setupEventListeners(){console.log("ðŸš€ Setup Event-Listener..."),this.addEventHandler("submit",t=>{var e=t.target.closest('form[action*="/cart/add"]');e&&(console.log("ðŸš€ Form Submit Event erkannt:",e),t.preventDefault(),t.stopPropagation(),this.handleAddToCart(e))}),this.addEventHandler("click",t=>{var e,r=t.target.closest('button[type="submit"][name="add"], button[name="add"], .btn-add-to-cart');r&&(e=r.closest('form[action*="/cart/add"]'))&&(this.syncInProgress?(console.log("ðŸš€ Add-to-Cart bereits in Bearbeitung, ignoriere Click"),t.preventDefault(),t.stopPropagation()):(console.log("ðŸš€ Add-to-Cart Button Click erkannt:",r,e),t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),this.handleAddToCart(e)))}),this.addEventHandler("click",t=>{var e=t.target.closest("cart-remove-button, .cart-remove-button");e&&(t.preventDefault(),t.stopPropagation(),this.handleRemoveFromCart(e))}),this.addEventHandler("click",t=>{t.target.closest('.is-view-cart, [name="view-cart"], .card-product__view-cart')&&(t.preventDefault(),t.stopPropagation(),this.openCartDrawer())}),this.addEventHandler("click",t=>{var e=t.target.closest('a[href*="/cart"]');e&&("/cart"===(e=e.getAttribute("href"))||"/cart/"===e||e.endsWith("/cart")||e.endsWith("/cart/"))&&(t.preventDefault(),this.openCartDrawer())}),window.addEventListener("pageshow",()=>{setTimeout(()=>this.syncCartState(),100)});let t=window.location.href;setInterval(()=>{window.location.href!==t&&(t=window.location.href,setTimeout(()=>this.syncCartState(),200))},500)}addEventHandler(e,r){var t=t=>{this.isActive&&(console.log("ðŸš€ Event Handler ausgefÃ¼hrt: "+e,t.target),r(t))};document.addEventListener(e,t,{capture:!0,passive:!1}),this.eventHandlers.has(e)||this.eventHandlers.set(e,[]),this.eventHandlers.get(e).push(t)}async handleAddToCart(t){if(!this.syncInProgress){console.log("ðŸš€ Add-to-Cart verarbeitet fÃ¼r Form:",t),this.syncInProgress=!0;var e=t.querySelector('button[type="submit"], button[name="add"]');e&&(e.classList.add("loading"),e.disabled=!0);try{var a,o,n=new FormData(t);let e=n.get("id"),r=(e&&"null"!==e&&""!==e||(a=t.querySelector('input[name="id"], select[name="id"], input[data-variant-id]'))&&(e=a.value),e&&"null"!==e&&""!==e||(o=t.querySelector("[data-variant-id]"))&&(e=o.dataset.variantId),e=parseInt(e),parseInt(t.dataset.productId||t.closest("[data-product-id]")?.dataset.productId));if(console.log("ðŸš€ PrÃ¼fe Produkt:",{productId:r,variantId:e,formData:Object.fromEntries(n)}),!e||isNaN(e))console.error("ðŸš€ Keine gÃ¼ltige Variant ID gefunden!"),this.showToastMessage("Fehler: Keine gÃ¼ltige Produktvariante gefunden","error");else{if(this.cartData&&this.cartData.items)if(this.cartData.items.find(t=>t.product_id===r||t.variant_id===e))return console.log("ðŸš€ Produkt bereits im Cart - Ã¶ffne Drawer statt hinzuzufÃ¼gen"),this.showToastMessage("Produkt ist bereits im Warenkorb"),void this.openCartDrawer();n.set("id",e.toString()),n.set("quantity","1"),console.log("ðŸš€ Sende Add-to-Cart Request...");var i,s,l=await fetch("/cart/add.js",{method:"POST",body:n});l.ok?(i=await l.json(),console.log("ðŸš€ Add-to-Cart erfolgreich:",i),await new Promise(t=>setTimeout(t,200)),await this.syncCartState(),await new Promise(t=>setTimeout(t,200)),await this.syncCartState(),console.log("ðŸš€ Cart-Daten nach Add-to-Cart:",this.cartData),this.updateAllButtons(),this.updateCartIcon(),this.openCartDrawer(),setTimeout(()=>{this.forceShowCartContents()},50),setTimeout(async()=>{await this.updateCartDrawer(),this.forceShowCartContents()},100),setTimeout(async()=>{await this.updateCartDrawer(),this.forceShowCartContents()},500),setTimeout(async()=>{await this.updateCartDrawer(),this.forceShowCartContents()},1e3)):(s=await l.text(),console.error("ðŸš€ Add-to-Cart Fehler:",l.status,s),alert("Fehler beim HinzufÃ¼gen zum Warenkorb"))}}catch(t){console.error("ðŸš€ Add-to-Cart Exception:",t),alert("Fehler beim HinzufÃ¼gen zum Warenkorb")}finally{e&&(e.classList.remove("loading"),e.disabled=!1),this.syncInProgress=!1}}}async handleRemoveFromCart(e){if(!this.syncInProgress){console.log("ðŸš€ Remove-from-Cart verarbeitet fÃ¼r:",e),this.syncInProgress=!0;var r,a,o,n,i,s=e.querySelector("button")||e;s&&(s.classList.add("loading"),s.disabled=!0);try{let t=e.dataset.index||e.getAttribute("data-index")||s?.dataset.index||s?.getAttribute("data-index");t||(r=e.closest(".cart-item, [data-index]"))&&(t=r.dataset.index||r.getAttribute("data-index")),console.log("ðŸš€ Cart Index gefunden:",t),t?(a=await fetch("/cart/change.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({line:parseInt(t),quantity:0})})).ok?(o=await a.json(),console.log("ðŸš€ Remove-from-Cart erfolgreich:",o),this.cartData=o,this.saveToCache(o),this.updateAllButtons(),this.updateCartIcon(),await this.updateCartDrawer(),0===o.item_count&&(console.log("ðŸš€ Cart ist nach Remove leer - zeige Empty State"),n=document.querySelector("cart-drawer"))&&"function"==typeof n.handleEmptyCart&&n.handleEmptyCart(!0)):(i=await a.text(),console.error("ðŸš€ Remove-from-Cart Fehler:",a.status,i),alert("Fehler beim Entfernen aus dem Warenkorb")):console.error("ðŸš€ Kein Cart Index gefunden fÃ¼r Remove Button")}catch(t){console.error("ðŸš€ Remove-from-Cart Exception:",t),alert("Fehler beim Entfernen aus dem Warenkorb")}finally{s&&(s.classList.remove("loading"),s.disabled=!1),this.syncInProgress=!1}}}async syncCartState(){if(!this.syncInProgress){var t=Date.now();if(!(t-this.lastSyncTime<500)){this.syncInProgress=!0,this.lastSyncTime=t;try{console.log("ðŸš€ Synchronisiere Cart State...");var e=(new Date).getTime(),r=await(await fetch("/cart.js?t="+e)).json();(!this.cartData||this.cartData.item_count!==r.item_count||JSON.stringify(this.cartData.items)!==JSON.stringify(r.items))&&(this.cartData=r,this.saveToCache(r),this.updateAllButtons(),this.updateCartIcon(),console.log("ðŸš€ Cart State aktualisiert:",{itemCount:this.cartData.item_count,items:r.items.map(t=>({id:t.id,title:t.title,quantity:t.quantity}))}))}catch(t){console.error("ðŸš€ Sync-Fehler:",t)}finally{this.syncInProgress=!1}}}}updateAllButtons(){this.cartData&&(console.log("ðŸš€ Aktualisiere alle Buttons mit",this.cartData.item_count,"Artikeln im Cart..."),document.querySelectorAll("[data-product-id]").forEach(t=>{this.updateProductCardButton(t)}),document.querySelectorAll("product-form").forEach(t=>{this.updatePDPButton(t)}),document.querySelectorAll('form[action*="/cart/add"]').forEach(t=>{this.updateGenericCartForm(t)}))}updateProductCardButton(t){let e=parseInt(t.dataset.productId);var r=t.querySelector('[name="id"]');let a=r?parseInt(r.value):null;var r=this.cartData.items.some(t=>t.product_id===e||a&&t.variant_id===a),o=t.querySelector('.card-product__add-form, form[action*="/cart/add"]');let n=t.querySelector(".card-product__view-cart, .is-view-cart");r?(o&&(o.style.display="none"),(n=n||this.createViewCartButton(t))&&(n.style.display="block",n.textContent=window.variantStrings?.view_cart_button||"View Cart")):(o&&(o.style.display="block"),n&&(n.style.display="none"))}updatePDPButton(t){var e=t.querySelector("form");let r=parseInt(e?.dataset.productId);e=t.querySelector('[name="id"]');let a=e?parseInt(e.value):null;var e=this.cartData.items.some(t=>t.product_id===r||a&&t.variant_id===a),t=t.querySelector('button[type="submit"], button[name="add"]');!t||t.hasAttribute("disabled")||t.classList.contains("request-only-button")||(e?(t.type="button",t.onclick=()=>this.openCartDrawer(),(e=t.querySelector("span"))&&(e.textContent=window.variantStrings?.view_cart_button||"View Cart")):(t.type="submit",t.onclick=null,(e=t.querySelector("span"))&&(e.textContent=window.variantStrings?.addToCart||"Add to Cart")))}updateGenericCartForm(t){let e=parseInt(t.dataset.productId||t.closest("[data-product-id]")?.dataset.productId);var r=t.querySelector('[name="id"]');let a=r?parseInt(r.value):null;(e||a)&&(r=this.cartData.items.some(t=>t.product_id===e||a&&t.variant_id===a),t=t.querySelector('button[type="submit"], button[name="add"]'))&&!t.hasAttribute("disabled")&&(r?(t.type="button",t.onclick=()=>this.openCartDrawer(),(t.querySelector("span")||t).textContent=window.variantStrings?.view_cart_button||"View Cart"):(t.type="submit",t.onclick=null,(t.querySelector("span")||t).textContent=window.variantStrings?.addToCart||"Add to Cart"))}createViewCartButton(t){var e,t=t.querySelector(".card-product__actions");return t?((e=document.createElement("button")).className="card-product__view-cart button button--full-width button--primary is-view-cart",e.type="button",e.innerHTML=`<span>${window.variantStrings?.view_cart_button||"View Cart"}</span>`,t.appendChild(e),e):null}setupCartDrawer(){console.log("ðŸš€ Setup Cart Drawer..."),document.addEventListener("click",t=>{t.target.closest("[data-cart-drawer-trigger]")&&(t.preventDefault(),this.openCartDrawer())}),customElements.get("cart-drawer")&&console.log("ðŸš€ Cart Drawer Custom Element gefunden")}openCartDrawer(){console.log("ðŸš€ Ã–ffne Cart Drawer");var t=document.querySelector("cart-drawer");t&&"function"==typeof t.open&&t.open()}forceShowCartContents(){let e=document.querySelector("cart-drawer");e&&(console.log("ðŸš€ Erzwinge Anzeige der Cart-Inhalte"),e.classList.remove("is-empty"),[".cart__contents","cart-items",".cart-items",".title-wrapper-with-link",".cart__footer",".drawer__footer",".drawer__cart-items-wrapper"].forEach(t=>{e.querySelectorAll(t).forEach(t=>{t.style.setProperty("display","block","important")})}),e.querySelectorAll(".cart__empty-text, .drawer__inner-empty").forEach(t=>{t.style.setProperty("display","none","important")}),console.log("ðŸš€ Cart-Inhalte erzwungen sichtbar gemacht"))}async updateCartDrawer(){var e=document.querySelector("cart-drawer");if(e)if(this.cartData){console.log("ðŸš€ Aktualisiere Cart Drawer mit",this.cartData.item_count,"Artikeln");try{var t=(new Date).getTime(),r=await(await fetch("/cart.js?t="+t)).json();this.cartData=r,this.saveToCache(r),console.log("ðŸš€ Frische Cart-Daten geladen:",{itemCount:r.item_count,items:r.items.map(t=>({id:t.id,title:t.title,quantity:t.quantity}))}),0===r.item_count?(console.log("ðŸš€ Cart ist leer - zeige Empty State"),"function"==typeof e.handleEmptyCart&&e.handleEmptyCart(!0)):(console.log("ðŸš€ Cart hat Inhalte - rendere Cart Contents"),"function"==typeof e.renderContents&&e.renderContents(r))}catch(t){console.error("ðŸš€ Fehler beim Laden frischer Cart-Daten:",t),0===this.cartData.item_count?"function"==typeof e.handleEmptyCart&&e.handleEmptyCart(!0):"function"==typeof e.renderContents&&e.renderContents(this.cartData)}}else console.warn("ðŸš€ Keine Cart-Daten fÃ¼r Drawer Update");else console.warn("ðŸš€ Cart Drawer Element nicht gefunden")}setupCartIconUpdater(){console.log("ðŸš€ Setup Cart Icon Updater..."),this.updateCartIcon()}updateCartIcon(){var t,e,r=document.getElementById("cart-icon-bubble");r&&this.cartData&&(t=this.cartData.item_count||0,(e=r.querySelector('.cart-count-bubble span[aria-hidden="true"]'))&&(e.textContent=t),(e=r.querySelector(".cart-count-bubble"))&&(e.style.display=0<t?"block":"none"),console.log("ðŸš€ Cart Icon aktualisiert:",t,"Artikel"))}setupCartRedirect(){console.log("ðŸš€ Setup Cart Redirect...")}setupInfiniteScroll(){console.log("ðŸš€ Setup Infinite Scroll..."),this.initInfiniteScrollManager();var t=new MutationObserver(t=>{t.forEach(t=>{t.addedNodes.forEach(t=>{1===t.nodeType&&((t.querySelectorAll?t.querySelectorAll("[data-product-id]"):[]).forEach(t=>{this.initializeProductCard(t),this.updateProductCardButton(t)}),(t.querySelectorAll?t.querySelectorAll("product-form"):[]).forEach(t=>{this.initializeProductForm(t)}))})})}),e=document.querySelector(".collection-products, .product-grid, #product-grid");e&&t.observe(e,{childList:!0,subtree:!0})}initInfiniteScrollManager(){var t;document.querySelector("#product-grid, .collection-products")&&(this.infiniteScroll={isLoading:!1,hasMoreProducts:!0,currentPage:1,productsPerPage:36,loadingThreshold:300},(t=document.querySelector(".pagination-wrapper, .pagination"))&&(t.style.display="none"),this.removeLoadMoreButtons(),this.setupInfiniteScrollListener())}setupInfiniteScrollListener(){let t;window.addEventListener("scroll",()=>{clearTimeout(t),t=setTimeout(()=>{this.shouldLoadMoreProducts()&&this.loadMoreProducts()},100)})}shouldLoadMoreProducts(){return!(this.infiniteScroll.isLoading||!this.infiniteScroll.hasMoreProducts)&&window.scrollY+window.innerHeight>=document.documentElement.scrollHeight-this.infiniteScroll.loadingThreshold}async loadMoreProducts(){if(!this.infiniteScroll.isLoading){this.infiniteScroll.isLoading=!0,this.showInfiniteScrollLoading();try{var t=this.infiniteScroll.currentPage+1,e=new URL(window.location);e.searchParams.set("page",t);var r=await(await fetch(e)).text(),a=(new DOMParser).parseFromString(r,"text/html").querySelectorAll("#product-grid .grid__item, .collection-products .grid__item");if(0<a.length){let e=document.querySelector("#product-grid, .collection-products");a.forEach(t=>{t.classList.add("infinite-scroll-new"),e.appendChild(t);t=t.querySelector("[data-product-id]");t&&(this.initializeProductCard(t),this.updateProductCardButton(t))}),this.infiniteScroll.currentPage=t}else this.infiniteScroll.hasMoreProducts=!1}catch(t){console.error("ðŸš€ Infinite Scroll Fehler:",t),this.showInfiniteScrollError()}finally{this.infiniteScroll.isLoading=!1,this.hideInfiniteScrollLoading()}}}showInfiniteScrollLoading(){let t=document.querySelector(".infinite-scroll-loading");var e;!t&&((t=document.createElement("div")).className="infinite-scroll-loading",t.innerHTML=`
        <div class="loading-overlay">
          <div class="loading__spinner">
            <svg class="spinner" viewBox="0 0 50 50">
              <circle class="path" cx="25" cy="25" r="20" fill="none" stroke="currentColor" stroke-width="2" stroke-miterlimit="10"/>
            </svg>
          </div>
          <div class="loading-text">Loading more products...</div>
        </div>
      `,e=document.querySelector("#product-grid, .collection-products"))&&e.parentNode.appendChild(t),t.style.display="block"}hideInfiniteScrollLoading(){var t=document.querySelector(".infinite-scroll-loading");t&&(t.style.display="none")}showInfiniteScrollError(){var t=document.createElement("div"),e=(t.className="infinite-scroll-error",t.innerHTML=`
      <p>Error loading more products</p>
      <button class="button" onclick="window.location.reload()">Retry</button>
    `,document.querySelector("#product-grid, .collection-products"));e&&e.parentNode.appendChild(t)}removeLoadMoreButtons(){console.log("ðŸš€ Entferne Load More Buttons..."),document.querySelectorAll(".infinite-scroll-load-more, .load-more-button, .btn-load-more").forEach(t=>{t.remove(),console.log("ðŸš€ Load More Button entfernt (CSS):",t)}),document.querySelectorAll("button").forEach(t=>{let e=t.textContent.toLowerCase().trim();["weitere produkte laden","loading more products","caricamento di altri prodotti","chargement de plus de produits","cargando mÃ¡s productos","load more","mehr laden"].some(t=>e.includes(t))&&(t.remove(),console.log("ðŸš€ Load More Button entfernt (Text):",t))}),console.log("ðŸš€ Alle Load More Buttons entfernt")}setupUnitConverter(){console.log("ðŸš€ Setup Unit Converter..."),document.addEventListener("click",t=>{t.target.closest(".unit-toggle, [data-unit-toggle]")&&(t.preventDefault(),this.toggleUnits())}),this.updateUnitDisplay()}toggleUnits(){var t=localStorage.getItem("preferred_unit")||"metric";localStorage.setItem("preferred_unit","metric"===t?"imperial":"metric"),this.updateUnitDisplay()}updateUnitDisplay(){let a=localStorage.getItem("preferred_unit")||"metric";document.querySelectorAll("[data-metric], [data-imperial]").forEach(t=>{var e=t.dataset.metric,r=t.dataset.imperial;"imperial"===a&&r?t.textContent=r:e&&(t.textContent=e)}),this.convertMetricToImperial()}convertMetricToImperial(){var t=localStorage.getItem("preferred_unit");if("imperial"===t){let r=.0393701;document.querySelectorAll(".metric-length").forEach(t=>{var e=parseFloat(t.textContent);isNaN(e)||(e=(e*r).toFixed(2),t.textContent=e+" in")}),document.querySelectorAll(".metric-width").forEach(t=>{var e=parseFloat(t.textContent);isNaN(e)||(e=(e*r).toFixed(2),t.textContent=e+" in")}),document.querySelectorAll(".metric-height").forEach(t=>{var e=parseFloat(t.textContent);isNaN(e)||(e=(e*r).toFixed(2),t.textContent=e+" in")}),document.querySelectorAll(".metric-weight").forEach(t=>{var e=parseFloat(t.textContent);isNaN(e)||(e=(.00220462*e).toFixed(2),t.textContent=e+" lb")})}}setupExternalLinks(){console.log("ðŸš€ Setup External Links..."),document.addEventListener("click",t=>{t=t.target.closest("a[href]");t&&this.isExternalLink(t)&&(t.setAttribute("target","_blank"),t.setAttribute("rel","noopener noreferrer"))})}isExternalLink(t){t=t.getAttribute("href");if(!t)return!1;if(t.startsWith("/")||t.startsWith("#")||t.startsWith("mailto:")||t.startsWith("tel:"))return!1;try{return new URL(t,window.location.origin).hostname!==window.location.hostname}catch{return!1}}setupBrowserNavigationFix(){console.log("ðŸš€ Setup Browser Navigation Fix..."),window.addEventListener("pageshow",t=>{t.persisted&&(console.log("ðŸš€ Page aus Cache geladen - synchronisiere Cart"),setTimeout(()=>this.syncCartState(),100))}),window.addEventListener("popstate",()=>{console.log("ðŸš€ Browser Navigation erkannt - synchronisiere Cart"),setTimeout(()=>this.syncCartState(),200)}),window.addEventListener("focus",()=>{this.cartData&&setTimeout(()=>this.syncCartState(),100)}),document.addEventListener("visibilitychange",()=>{!document.hidden&&this.cartData&&setTimeout(()=>this.syncCartState(),100)})}initializeUIComponents(){console.log("ðŸš€ Initialisiere UI-Komponenten..."),setTimeout(()=>{this.updateAllButtons(),this.updateCartIcon()},100),this.setupProductCards(),this.setupProductForms(),this.setupQuantityLimits()}setupProductCards(){console.log("ðŸš€ Setup Product Cards..."),document.querySelectorAll("[data-product-id]").forEach(t=>{this.initializeProductCard(t)})}initializeProductCard(t){t.querySelectorAll(".vat-info-button").forEach(t=>{t.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),this.openVatPopup()})});t=t.querySelector(".card-product__link, .full-unstyled-link");t&&t.addEventListener("click",t=>{if(t.target.closest('.is-view-cart, [name="view-cart"], .card-product__view-cart'))return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),this.openCartDrawer(),!1},{capture:!0})}setupProductForms(){console.log("ðŸš€ Setup Product Forms..."),document.querySelectorAll("product-form").forEach(t=>{this.initializeProductForm(t)})}initializeProductForm(t){var e=t.querySelector('[name="id"]');e&&e.addEventListener("change",()=>{setTimeout(()=>this.updatePDPButton(t),100)}),setTimeout(()=>this.updatePDPButton(t),100)}showToastMessage(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"info",r=(console.log("ðŸš€ Toast Message:",t),document.querySelector(".master-cart-toast"));r&&r.remove();let a=document.createElement("div");a.className="master-cart-toast master-cart-toast--"+e,a.innerHTML=`
      <div class="master-cart-toast__content">
        <span class="master-cart-toast__message">${t}</span>
        <button class="master-cart-toast__close" onclick="this.parentElement.parentElement.remove()">Ã—</button>
      </div>
    `,a.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      background: ${"error"===e?"#dc3545":"#28a745"};
      color: white;
      padding: 12px 16px;
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      z-index: 10000;
      font-size: 14px;
      max-width: 300px;
      animation: slideInRight 0.3s ease;
    `,document.querySelector("#master-cart-toast-styles")||((r=document.createElement("style")).id="master-cart-toast-styles",r.textContent=`
        @keyframes slideInRight {
          from { transform: translateX(100%); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
        .master-cart-toast__content {
          display: flex;
          align-items: center;
          justify-content: space-between;
        }
        .master-cart-toast__close {
          background: none;
          border: none;
          color: white;
          font-size: 18px;
          cursor: pointer;
          margin-left: 10px;
          padding: 0;
          line-height: 1;
        }
      `,document.head.appendChild(r)),document.body.appendChild(a),setTimeout(()=>{a.parentElement&&a.remove()},3e3)}setupQuantityLimits(){console.log("ðŸš€ Setup Quantity Limits..."),document.querySelectorAll('input[name="quantity"], .quantity__input').forEach(t=>{t.setAttribute("max","1"),t.setAttribute("value","1"),t.addEventListener("input",t=>{var e=parseInt(t.target.value);1<e&&(t.target.value="1",this.showToastMessage("Maximal 1 StÃ¼ck pro Produkt erlaubt","error")),e<1&&(t.target.value="1")}),t.addEventListener("change",t=>{var e=parseInt(t.target.value);1<e&&(t.target.value="1",this.showToastMessage("Maximal 1 StÃ¼ck pro Produkt erlaubt","error")),e<1&&(t.target.value="1")})}),document.querySelectorAll(".quantity__button").forEach(t=>{"plus"!==t.name&&!t.classList.contains("quantity__button--plus")||(t.disabled=!0,t.style.opacity="0.5",t.style.cursor="not-allowed",t.addEventListener("click",t=>{t.preventDefault(),this.showToastMessage("Maximal 1 StÃ¼ck pro Produkt erlaubt","error")}))})}openVatPopup(){console.log("ðŸš€ Ã–ffne VAT Popup")}loadFromCache(){try{var t=localStorage.getItem("master_cart_cache");if(t){var{data:e,timestamp:r}=JSON.parse(t);if(Date.now()-r<12e4)return e}}catch(t){console.warn("ðŸš€ Cache-Fehler:",t)}return null}saveToCache(t){try{localStorage.setItem("master_cart_cache",JSON.stringify({data:t,timestamp:Date.now()}))}catch(t){console.warn("ðŸš€ Cache-Speicher-Fehler:",t)}}destroy(){console.log("ðŸš€ MasterCartSystem wird zerstÃ¶rt"),this.isActive=!1,this.eventHandlers.forEach((t,e)=>{t.forEach(t=>{document.removeEventListener(e,t)})}),this.eventHandlers.clear()}debug(){console.log("ðŸš€ === MASTER CART SYSTEM DEBUG ==="),console.log("Aktiv:",this.isActive),console.log("Cart-Daten:",this.cartData),console.log("Artikel im Cart:",this.cartData?.item_count||0),this.cartData?.items&&this.cartData.items.forEach((t,e)=>{console.log(`Artikel ${e+1}:`,{productId:t.product_id,variantId:t.variant_id,title:t.title,quantity:t.quantity})}),console.log("Collection View Cart Buttons:",document.querySelectorAll('.is-view-cart, [name="view-cart"], .card-product__view-cart').length);var t=document.querySelector("product-form");t&&(t=t.querySelector('button[type="submit"], button[type="button"]'),console.log("PDP Button:",{type:t?.type,text:t?.textContent?.trim(),disabled:t?.hasAttribute("disabled")})),console.log("ðŸš€ === END DEBUG ===")}}if(!customElements.get("cart-drawer")){class Wb extends HTMLElement{constructor(){super(),this.addEventListener("keyup",t=>"Escape"===t.code&&this.close()),this.querySelector("#CartDrawer-Overlay")?.addEventListener("click",this.close.bind(this))}open(){if(console.log("ðŸš€ Cart Drawer: open() aufgerufen"),this.classList.contains("active"))console.log("ðŸš€ Cart Drawer: Bereits aktiv");else{this.classList.add("active"),this.style.pointerEvents="auto",document.body.classList.add("overflow-hidden");var e=this.querySelector(".drawer__inner"),r=this.querySelector(".drawer__inner-empty");let t=e||r;console.log("ðŸš€ Cart Drawer: Starte Open Animation fÃ¼r:",t),this.style.opacity="0",t&&(t.style.transform="translateX(100%)"),this.offsetHeight,requestAnimationFrame(()=>{this.style.cssText+=`
          transition: opacity 0.4s ease !important;
          opacity: 1 !important;
        `,t&&(t.style.cssText+=`
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;
            transform: translateX(0) !important;
          `)}),setTimeout(()=>{t&&t.focus(),t&&(t.style.cssText=""),this.style.cssText=""},450),document.dispatchEvent(new CustomEvent("drawer:opened",{detail:{drawer:this}}))}}close(){if(console.log("ðŸš€ Cart Drawer: close() aufgerufen"),this.classList.contains("closing"))console.log("ðŸš€ Cart Drawer: Bereits beim SchlieÃŸen");else{this.classList.add("closing");var e=this.querySelector(".drawer__inner"),r=this.querySelector(".drawer__inner-empty");let t=e||r;console.log("ðŸš€ Cart Drawer: Starte Close Animation fÃ¼r:",t),t&&(t.offsetHeight,t.style.cssText+=`
          transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;
          transform: translateX(100%) !important;
        `),this.style.cssText+=`
        transition: opacity 0.4s ease !important;
        opacity: 0 !important;
      `,setTimeout(()=>{console.log("ðŸš€ Cart Drawer: Animation beendet, verstecke Element"),this.classList.remove("active","closing"),this.style.pointerEvents="none",document.body.classList.remove("overflow-hidden"),t&&(t.style.cssText=""),this.style.cssText=""},400),document.dispatchEvent(new CustomEvent("drawer:closed",{detail:{drawer:this}}))}}renderContents(t){var e,r,a,o,n,i;console.log("ðŸš€ Cart Drawer: renderContents() aufgerufen",t),t?(e=this.querySelector(".drawer__inner"),r=this.querySelector(".drawer__inner-empty"),0===t.item_count?(console.log("ðŸš€ Cart Drawer: Cart ist leer - zeige Empty State"),this.classList.add("is-empty"),e&&(e.style.display="none"),r&&(r.style.display="flex"),this.showEmptyState()):(console.log("ðŸš€ Cart Drawer: Cart hat",t.item_count,"Artikel - zeige Inhalte"),this.classList.remove("is-empty"),a=this.querySelector(".cart__contents"),o=this.querySelector("cart-items, .cart-items"),n=this.querySelector(".cart__footer"),i=this.querySelector(".title-wrapper-with-link"),a&&(a.style.display="block"),o&&(o.style.display="block"),n&&(n.style.display="block"),i&&(i.style.display="block"),r&&(r.style.display="none"),e&&(e.style.display="flex"),this.showCartContents(t))):console.warn("ðŸš€ Cart Drawer: Keine Cart-Daten erhalten")}showEmptyState(){console.log("ðŸš€ Cart Drawer: showEmptyState() aufgerufen");[".drawer__cart-items-wrapper",".cart__contents","cart-items",".cart-items",".drawer__footer",".cart__footer",".title-wrapper-with-link"].forEach(e=>{this.querySelectorAll(e).forEach(t=>{t.style.setProperty("display","none","important"),console.log("ðŸš€ Cart Drawer: Element versteckt:",e)})});[".drawer__inner-empty",".cart__empty-text",".empty-state"].forEach(e=>{this.querySelectorAll(e).forEach(t=>{t.style.setProperty("display","flex","important"),console.log("ðŸš€ Cart Drawer: Empty Element sichtbar gemacht:",e)})}),this.querySelector(".drawer__inner-empty, .cart__empty-text")||(console.log("ðŸš€ Cart Drawer: Erstelle Fallback Empty State"),this.createFallbackEmptyState())}createFallbackEmptyState(){var t=this.querySelector(".drawer__inner");t&&(t.insertAdjacentHTML("beforeend",`
          <div class="cart__empty-text fallback-empty-state" style="display: flex !important; flex-direction: column; align-items: center; justify-content: center; padding: 2rem; text-align: center; height: 100%;">
            <h2 style="margin-bottom: 1rem; color: #333;">Your cart is empty</h2>
            <p style="color: #666; margin-bottom: 2rem;">Add some products to get started</p>
            <button onclick="this.closest('cart-drawer').close()" style="background: #333; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 4px; cursor: pointer;">Continue Shopping</button>
          </div>
        `),console.log("ðŸš€ Cart Drawer: Fallback Empty State erstellt"))}showCartContents(e){console.log("ðŸš€ Cart Drawer: showCartContents() mit",e.item_count,"Artikeln"),this.classList.remove("is-empty");[".drawer__cart-items-wrapper",".cart__contents","cart-items",".cart-items",".drawer__footer",".cart__footer",".title-wrapper-with-link"].forEach(t=>{var e=this.querySelector(t);e&&(e.style.display="block",console.log("ðŸš€ Cart Drawer: Element sichtbar gemacht:",t))});var t=this.querySelector(".drawer__inner-empty");t&&(t.style.display="none",console.log("ðŸš€ Cart Drawer: Empty Content versteckt")),this.fetchAndRenderCartSections(e).catch(t=>{console.error("ðŸš€ Cart Drawer: Section Rendering fehlgeschlagen, verwende Fallback:",t),this.renderCartFallback(e)})}async fetchAndRenderCartSections(e){try{console.log("ðŸš€ Cart Drawer: Hole Cart Sections...");var r,a,o,n,i,s,l,c,d=[window.location.pathname+"?sections=cart-drawer","/?sections=cart-drawer","/cart?sections=cart-drawer"];let t=null;for(r of d)try{console.log("ðŸš€ Cart Drawer: Versuche URL:",r);var u=await fetch(r);if((t=await u.json())&&t["cart-drawer"]){console.log("ðŸš€ Cart Drawer: Section erfolgreich geladen von:",r);break}}catch(t){console.warn("ðŸš€ Cart Drawer: URL fehlgeschlagen:",r,t);continue}t&&t["cart-drawer"]?(console.log("ðŸš€ Cart Drawer: Section erhalten, aktualisiere Inhalt"),(a=document.createElement("div")).innerHTML=t["cart-drawer"],o=a.querySelector("#CartDrawer-CartItems, .drawer__cart-items-wrapper, .cart-items, [data-cart-items]"),n=this.querySelector("#CartDrawer-CartItems, .drawer__cart-items-wrapper, .cart-items, [data-cart-items]"),o&&n?(n.innerHTML=o.innerHTML,console.log("ðŸš€ Cart Drawer: Cart Items aktualisiert"),this.initializeRemoveButtons()):(console.warn("ðŸš€ Cart Drawer: Cart Items Container nicht gefunden"),console.log("ðŸš€ Cart Drawer: VerfÃ¼gbare Container im neuen HTML:",a.querySelectorAll('*[id], *[class*="cart"], *[class*="drawer"]')),console.log("ðŸš€ Cart Drawer: VerfÃ¼gbare Container im aktuellen Drawer:",this.querySelectorAll('*[id], *[class*="cart"], *[class*="drawer"]')),i=this.querySelector(".drawer__inner"),s=a.querySelector(".drawer__inner"),i&&s&&(i.innerHTML=s.innerHTML,console.log("ðŸš€ Cart Drawer: Gesamter Drawer Inner aktualisiert"),this.initializeRemoveButtons())),l=a.querySelector(".drawer__footer"),c=this.querySelector(".drawer__footer"),l&&c&&(c.innerHTML=l.innerHTML,console.log("ðŸš€ Cart Drawer: Footer aktualisiert"))):(console.warn("ðŸš€ Cart Drawer: Keine Section erhalten, verwende Fallback"),this.renderCartFallback(e))}catch(t){console.error("ðŸš€ Cart Drawer: Fehler beim Section Fetch:",t),this.renderCartFallback(e)}}renderCartFallback(t){console.log("ðŸš€ Cart Drawer: Verwende Fallback Rendering fÃ¼r",t.item_count,"Artikel");var e=this.querySelector("#CartDrawer-CartItems, .drawer__cart-items-wrapper, .cart-items");if(e&&t&&t.items&&0<t.items.length){console.log("ðŸš€ Cart Drawer: Rendere",t.items.length,"Artikel im Fallback");let o='<div class="cart-items-fallback" style="padding: 1rem;">';o+=`<h3 style="margin-bottom: 1rem;">Warenkorb (${t.item_count} Artikel)</h3>`,t.items.forEach((t,e)=>{var r=t.price?(t.price/100).toFixed(2):"0.00",a=t.image?`<img src="${t.image}" alt="${t.title}" style="width: 60px; height: 60px; object-fit: cover; margin-right: 1rem;">`:"";o+=`
            <div class="cart-item-fallback" data-index="${e+1}" style="display: flex; align-items: center; padding: 1rem 0; border-bottom: 1px solid #eee;">
              ${a}
              <div class="cart-item-info" style="flex: 1;">
                <h4 style="margin: 0 0 0.5rem 0; font-size: 14px;">${t.title||"Unbekanntes Produkt"}</h4>
                <p style="margin: 0; color: #666; font-size: 12px;">Menge: ${t.quantity||1}</p>
                <p style="margin: 0; font-weight: bold; font-size: 14px;">${r} â‚¬</p>
              </div>
              <button class="cart-remove-fallback" data-index="${e+1}" style="background: #dc3545; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">Entfernen</button>
            </div>
          `});t=t.total_price?(t.total_price/100).toFixed(2):"0.00";o=o+`
          <div style="padding: 1rem 0; text-align: right; font-weight: bold; font-size: 16px;">
            Gesamt: ${t} â‚¬
          </div>
        `+"</div>",e.innerHTML=o,console.log("ðŸš€ Cart Drawer: Fallback HTML eingefÃ¼gt"),this.initializeRemoveButtons()}else console.warn("ðŸš€ Cart Drawer: Kein Container oder keine Items fÃ¼r Fallback gefunden")}initializeRemoveButtons(){console.log("ðŸš€ Cart Drawer: Initialisiere Remove Buttons");var t=this.querySelectorAll("cart-remove-button, .cart-remove-button, .cart-remove-fallback, [data-index] button");console.log("ðŸš€ Cart Drawer: Gefundene Remove Buttons:",t.length),t.forEach((t,e)=>{let r=t.cloneNode(!0);t.parentNode.replaceChild(r,t),r.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),console.log("ðŸš€ Cart Drawer: Remove Button geklickt:",r);t=r.dataset.index||r.getAttribute("data-index")||r.closest("[data-index]")?.dataset.index;t?(console.log("ðŸš€ Cart Drawer: Entferne Item mit Index:",t),window.masterCartSystem.removeCartItem(parseInt(t))):console.error("ðŸš€ Cart Drawer: Kein Index fÃ¼r Remove Button gefunden")}),console.log(`ðŸš€ Cart Drawer: Remove Button ${e+1} initialisiert`)})}handleEmptyCart(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];console.log("ðŸš€ Cart Drawer: handleEmptyCart() aufgerufen, autoClose:",t),this.classList.add("is-empty");[".cart__contents","cart-items",".cart-items",".title-wrapper-with-link",".cart__footer",".drawer__footer",".drawer__cart-items-wrapper"].forEach(t=>{this.querySelectorAll(t).forEach(t=>{t.style.setProperty("display","none","important")})}),this.querySelectorAll(".cart__empty-text, .drawer__inner-empty").forEach(t=>{t.style.setProperty("display","flex","important")}),this.showEmptyState(),t&&(console.log("ðŸš€ Cart Drawer: SchlieÃŸe automatisch in 1 Sekunde"),setTimeout(()=>{console.log("ðŸš€ Cart Drawer: Automatisches SchlieÃŸen wird ausgefÃ¼hrt"),this.close()},1e3))}}customElements.define("cart-drawer",Wb),console.log("ðŸš€ Cart Drawer Custom Element definiert")}if(!customElements.get("cart-drawer-items")){class gc extends HTMLElement{constructor(){super()}}customElements.define("cart-drawer-items",gc),console.log("ðŸš€ Cart Drawer Items Custom Element definiert")}window.MasterCartSystem=MasterCartSystem,window.masterCartSystem=new MasterCartSystem,window.debugMasterCart=()=>window.masterCartSystem.debug(),console.log("ðŸš€ Master Cart System geladen - Debug mit: debugMasterCart()");