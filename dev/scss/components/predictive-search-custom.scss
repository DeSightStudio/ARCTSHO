/**
 * Custom Predictive Search Styling
 * Redesigned search dropdown with white background, grid layout and modern styling
 */

/* ============================================================================ */
/* :::::::::::::::::::::::::: Main Dropdown Container ::::::::::::::::::::::::: */
/* ============================================================================ */

.predictive-search {
  background-color: $whiteColor !important;
  border: none !important;
  @include border-radius(0, 0, 12px, 12px);
  @include box-shadow(0, 8px, 24px, rgba(0, 0, 0, 0.15));
  border-top: 1px solid $grayColorLight;

  // Override theme variables
  --color-background: #{red($whiteColor)}, #{green($whiteColor)}, #{blue($whiteColor)};
  --popup-border-width: 0;
  --popup-corner-radius: 12px;
  --popup-shadow-horizontal-offset: 0;
  --popup-shadow-vertical-offset: 8px;
  --popup-shadow-blur-radius: 24px;
  --popup-shadow-opacity: 0.15;
}

/* ============================================================================ */
/* ::::::::::::::::::::::::: Results Groups Wrapper :::::::::::::::::::::::::: */
/* ============================================================================ */

.predictive-search__results-groups-wrapper {
  display: block !important;
  border-bottom: none !important;
  padding: 20px;
  gap: 0;
}

/* ============================================================================ */
/* :::::::::::::::::::::::::: Result Group Styling ::::::::::::::::::::::::::: */
/* ============================================================================ */

.predictive-search__result-group {
  display: block !important;
  flex: none !important;
  gap: 0;

  &:first-child {
    flex: none !important;
    margin-bottom: 20px;
  }
}

/* ============================================================================ */
/* ::::::::::::::::::::::::::::: Headings Styling :::::::::::::::::::::::::::: */
/* ============================================================================ */

.predictive-search__heading {
  border-bottom: 1px solid $grayColorLight !important;
  margin: 0 0 15px 0 !important;
  padding: 0 0 8px 0 !important;
  color: $mainColor !important;
  @include font-size(14px);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* ============================================================================ */
/* :::::::::::::::::::::::::: Hide Suggestions Completely ::::::::::::::::::: */
/* ============================================================================ */

// Hide all suggestions, queries, collections, pages, and articles
.predictive-search__result-group:first-child,
#predictive-search-results-queries-list,
#predictive-search-results-pages-list-desktop,
#predictive-search-results-pages-list-mobile,
.predictive-search__pages-wrapper {
  display: none !important;
}

// Hide suggestion headings
.predictive-search__heading {
  display: none !important;
}

// Show only products heading
#predictive-search-products {
  display: block !important;
  border-bottom: 1px solid $grayColorLight !important;
  margin: 0 0 15px 0 !important;
  padding: 0 0 8px 0 !important;
  color: $mainColor !important;
  @include font-size(14px);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* ============================================================================ */
/* :::::::::::::::::::::::::: Products Grid Layout ::::::::::::::::::::::::::: */
/* ============================================================================ */

#predictive-search-results-products-list {
  display: grid !important;
  grid-template-columns: 1fr; // Mobile First: 1 Spalte
  gap: 15px;
  margin-top: 15px !important;

  .predictive-search__list-item {
    margin: 0;

    .predictive-search__item {
      display: block !important;
      padding: 12px !important;
      border: 1px solid $grayColorLight;
      border-radius: 8px;
      @include transition(all 0.3s ease);
      background-color: $whiteColor;
      text-decoration: none;

      &:hover {
        border-color: $mainColor !important;
        @include box-shadow(0, 4px, 12px, rgba($mainColor, 0.1));
        background-color: $whiteColor !important;
        transform: translateY(-2px);
      }
    }

    .predictive-search__item--link-with-thumbnail {
      display: block !important;
      grid-template-columns: none !important;
      grid-template-areas: none !important;
      grid-column-gap: 0 !important;
    }
  }
}

/* ============================================================================ */
/* ::::::::::::::::::::::::: Product Card Styling :::::::::::::::::::::::::::: */
/* ============================================================================ */

.predictive-search__image {
  width: 100% !important;
  height: 120px !important;
  object-fit: contain !important;
  margin-bottom: 8px;
  border-radius: 4px;
  grid-area: none !important;
  // Bessere Bildqualität
  image-rendering: -webkit-optimize-contrast;
  image-rendering: crisp-edges;

  // Mobile: Deutlich größere Bilder für bessere Qualität bei 1-Spalten-Layout
  @include screen(small) {
    height: 250px !important; // Noch größer für schärfere Darstellung
    object-fit: cover !important; // Cover für bessere Bildausnutzung
  }

  @include screen(x-small) {
    height: 220px !important; // Auch auf sehr kleinen Screens größer
    object-fit: cover !important;
  }
}

.predictive-search__item-content {
  grid-area: none !important;
  display: block !important;
  flex-direction: column !important;
  text-align: center;

  .predictive-search__item-heading {
    @include font-size(24px);
    font-family: 'Copperplate', serif;
    color: $blackColor !important;
    margin: 0 0 4px 0 !important;
    line-height: 1.3;
    font-weight: 500;

    // Limit to 2 lines
    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .predictive-search__item-vendor {
    @include font-size(11px);
    color: $grayColor !important;
    margin-bottom: 4px;
    text-transform: uppercase;
    letter-spacing: 0.3px;
  }

  .price {
    @include font-size(32px);
    color: $mainColor !important;
    font-family: 'Copperplate', serif;
    font-weight: 600;
    margin-top: 4px !important;
  }
}

/* ============================================================================ */
/* :::::::::::::::::::::::::: Hide Search For Button :::::::::::::::::::::::::: */
/* ============================================================================ */

.predictive-search__search-for-button {
  display: none !important;
}

/* ============================================================================ */
/* :::::::::::::::::::::::::: Show All Results Button :::::::::::::::::::::::::: */
/* ============================================================================ */

.show-all-results-button {
  display: block;
  width: 100%;
  margin-top: 20px;
  padding: 12px 24px;
  background-color: $mainColor;
  color: $whiteColor;
  border: none;
  border-radius: 8px;
  @include font-size(14px);
  font-weight: 600;
  text-align: center;
  cursor: pointer;
  @include transition(all 0.3s ease);

  &:hover {
    background-color: darken($mainColor, 10%);
    transform: translateY(-1px);
  }
}

// Hide products beyond the 9th item
#predictive-search-results-products-list .predictive-search__list-item:nth-child(n+10) {
  display: none;
}

/* ============================================================================ */
/* ::::::::::::::::::::::::: Loading State Styling ::::::::::::::::::::::::::: */
/* ============================================================================ */

.predictive-search__loading-state {
  padding: 40px 20px !important;

  .spinner {
    border-color: $grayColorLight $grayColorLight $grayColorLight $mainColor !important;
  }
}

/* ============================================================================ */
/* :::::::::::::::::::::::::: Mobile Optimizations ::::::::::::::::::::::::::: */
/* ============================================================================ */

@include screen(small) {
  .predictive-search {
    left: 0 !important;
    right: 0 !important;
    width: 100% !important;
    @include border-radius(0, 0, 0, 0);
    max-height: 70vh;
    overflow-y: auto;
  }

  .predictive-search__results-groups-wrapper {
    padding: 15px;
  }

  .predictive-search__result-group:first-child {
    margin-bottom: 15px;
  }

  // Mobile: Größere Produktkarten für bessere Bilddarstellung
  .predictive-search__list-item {
    .predictive-search__item {
      padding: 15px !important; // Mehr Padding für größere Karten
      min-height: 320px; // Mindesthöhe für konsistente Darstellung
    }
  }
}

/* ============================================================================ */
/* ::::::::::::::::::::::::: Accessibility & Focus :::::::::::::::::::::::::: */
/* ============================================================================ */

.predictive-search__list-item[aria-selected='true'] > *,
.predictive-search__list-item:hover > * {
  background-color: rgba($mainColor, 0.08) !important;
  color: $mainColor !important;
}

.predictive-search__list-item[aria-selected='true'] .predictive-search__item-heading,
.predictive-search__list-item:hover .predictive-search__item-heading {
  text-decoration: none !important;
  color: $mainColor !important;
}

/* ============================================================================ */
/* :::::::::::::::::::::::::: Theme Variable Overrides :::::::::::::::::::::: */
/* ============================================================================ */

predictive-search[open] .predictive-search,
predictive-search[loading] .predictive-search {
  --color-foreground: #{red($blackColor)}, #{green($blackColor)}, #{blue($blackColor)};
  --color-background: #{red($whiteColor)}, #{green($whiteColor)}, #{blue($whiteColor)};
}

/* ============================================================================ */
/* ::::::::::::::::::::::::: Additional Responsive Fixes ::::::::::::::::::::: */
/* ============================================================================ */

// Mobile First Approach - Start with 1 column, then scale up
#predictive-search-results-products-list {
  // Default: 1 Spalte für alle mobilen Geräte
  grid-template-columns: 1fr !important;
  gap: 15px; // Mehr Abstand zwischen den Karten mobil
}

// Tablet: 2 Spalten ab 768px
@include screen(small, min) {
  #predictive-search-results-products-list {
    grid-template-columns: repeat(2, 1fr) !important;
    gap: 12px;
  }
}

// Desktop: 3 Spalten ab 1025px
@include screen(med, min) {
  #predictive-search-results-products-list {
    grid-template-columns: repeat(3, 1fr) !important;
    gap: 15px;
  }
}

/* ============================================================================ */
/* :::::::::::::::::::::::::: Pages Wrapper Styling :::::::::::::::::::::::::: */
/* ============================================================================ */

.predictive-search__pages-wrapper {
  .predictive-search__results-list {
    .predictive-search__list-item {
      .predictive-search__item {
        padding: 6px 0 !important;

        .predictive-search__item-heading {
          @include font-size(24px);
          color: $blackColor !important;
        }
      }
    }
  }
}

/* ============================================================================ */
/* ::::::::::::::::::::::::: Image Fallback Styling :::::::::::::::::::::::::: */
/* ============================================================================ */

// Ensure images without src still maintain proper spacing
.predictive-search__item--link-with-thumbnail {
  .predictive-search__image {
    background-color: $accentLight;
    border: 1px solid $grayColorLight;

    &:not([src]) {
      display: block !important;
      background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23f4f1e7"/><text x="50" y="50" text-anchor="middle" dy=".3em" fill="%238e8e8e" font-size="12">Bild</text></svg>');
      background-size: cover;
      background-position: center;
    }
  }
}

/* ============================================================================ */
/* :::::::::::::::::::::::::: Performance Optimizations :::::::::::::::::::::: */
/* ============================================================================ */

// Optimize grid rendering
#predictive-search-results-products-list {
  will-change: transform;

  .predictive-search__list-item {
    .predictive-search__item {
      will-change: transform, box-shadow;
    }
  }
}
